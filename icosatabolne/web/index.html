<!DOCTYPE html>
<html lang="en">
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.
    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="ICOSATABOLNE - Quantum Holographic Strategy">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="icosatabolne">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>ICOSATABOLNE | Quantum Strategy</title>
  <link rel="manifest" href="manifest.json">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">

  <!-- GSAP & Lenis -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
  <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>

  <style>
    :root {
      --color-bg: #050505;
      --color-text: #e0e0e0;
      --color-accent-holo: #00ffff;
      --color-accent-quantum: #bf00ff;
      --font-display: 'Syncopate', sans-serif;
      --font-body: 'Space Mono', monospace;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: var(--color-bg);
      color: var(--color-text);
      font-family: var(--font-body);
      overflow-x: hidden;
      overscroll-behavior: none;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: var(--color-bg);
    }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, var(--color-accent-quantum), var(--color-accent-holo));
      border-radius: 4px;
    }

    /* Noise Overlay */
    .noise-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      opacity: 0.05;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
    }

    /* Ambient Gradient */
    .ambient-gradient {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: radial-gradient(circle at 20% 30%, rgba(191, 0, 255, 0.15), transparent 40%),
                  radial-gradient(circle at 80% 70%, rgba(0, 255, 255, 0.1), transparent 40%);
      animation: breathe 25s infinite alternate ease-in-out;
    }

    @keyframes breathe {
      0% { transform: scale(1); opacity: 0.8; }
      100% { transform: scale(1.1); opacity: 1; }
    }

    /* Structure */
    .landing-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      z-index: 9999;
      background-color: var(--color-bg); /* Ensure opaque background */
    }

    section {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      position: relative;
    }

    /* Hero */
    .hero-content {
      text-align: center;
      perspective: 1000px;
    }

    h1.hero-title {
      font-family: var(--font-display);
      font-size: clamp(3rem, 8vw, 8rem);
      line-height: 1;
      text-transform: uppercase;
      letter-spacing: -0.05em;
      margin-bottom: 2rem;
      background: linear-gradient(90deg, #fff, var(--color-accent-holo), #fff);
      background-size: 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 8s linear infinite;
    }

    @keyframes shimmer {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    .hero-char {
      display: inline-block;
      opacity: 0; /* JS will reveal */
    }

    p.hero-subtitle {
      font-size: clamp(1rem, 2vw, 1.5rem);
      opacity: 0.7;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Cards Section */
    .cards-section {
      perspective: 1200px;
      overflow: hidden;
    }

    .card-wrapper {
      position: relative;
      width: 100%;
      max-width: 800px;
      height: 500px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .feature-card {
      width: 300px;
      height: 400px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      position: absolute;
      transform-style: preserve-3d;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .feature-card h3 {
      font-family: var(--font-display);
      color: var(--color-accent-quantum);
      margin-bottom: 1rem;
    }

    .feature-card p {
      font-size: 0.9rem;
      line-height: 1.6;
      opacity: 0.8;
    }

    .card-visual {
      flex-grow: 1;
      margin: 1rem 0;
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      position: relative;
      overflow: hidden;
    }

    .card-visual::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
        transform: rotate(45deg);
        animation: cardShimmer 3s infinite;
    }

    @keyframes cardShimmer {
        0% { transform: translateX(-100%) rotate(45deg); }
        100% { transform: translateX(100%) rotate(45deg); }
    }

    /* CTA Section */
    .cta-section {
      background: linear-gradient(to top, #000, transparent);
    }

    .cta-btn {
      font-family: var(--font-display);
      font-size: 2rem;
      padding: 1.5rem 4rem;
      background: transparent;
      color: var(--color-accent-holo);
      border: 2px solid var(--color-accent-holo);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .cta-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: var(--color-accent-holo);
      transition: all 0.3s ease;
      z-index: -1;
    }

    .cta-btn:hover {
      color: #000;
    }

    .cta-btn:hover::before {
      left: 0;
    }

    /* Footer */
    footer {
      padding: 2rem;
      text-align: center;
      font-size: 0.8rem;
      opacity: 0.5;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    /* Game Container - Hidden initially */
    #game-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s ease;
      background: #000;
    }

    #game-container.active {
      opacity: 1;
      pointer-events: all;
    }

    /* Loader for Flutter */
    #flutter-loader {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--color-accent-holo);
        font-family: var(--font-display);
        z-index: 101;
        display: none; /* Shown when Launch clicked */
    }

  </style>
</head>
<body>

  <div class="noise-overlay"></div>
  <div class="ambient-gradient"></div>

  <!-- Landing Content -->
  <div class="landing-container" id="landing">

    <section class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title" id="hero-title">Icosatabolne</h1>
        <p class="hero-subtitle">Quantum Holographic Strategy Engine v1.0</p>
      </div>
    </section>

    <section class="cards-section" id="features">
      <div class="card-wrapper">
        <!-- Card 1 -->
        <div class="feature-card card-1">
          <h3>Quantum State</h3>
          <div class="card-visual"></div>
          <p>Navigate the superposition of hexagonal grids. Every move collapses the wave function.</p>
        </div>
        <!-- Card 2 -->
        <div class="feature-card card-2" style="transform: translateZ(-100px) rotateY(10deg);">
          <h3>Holographic View</h3>
          <div class="card-visual"></div>
          <p>Project your strategy across dimensions. Visualizer reacts to entropy levels.</p>
        </div>
        <!-- Card 3 -->
        <div class="feature-card card-3" style="transform: translateZ(-200px) rotateY(-10deg);">
          <h3>Entropy Chaos</h3>
          <div class="card-visual"></div>
          <p>System instability increases with captures. Adapt or decohere.</p>
        </div>
      </div>
    </section>

    <section class="cta-section">
      <button class="cta-btn" id="launch-btn">Initialize System</button>
    </section>

    <footer>
      <p>&copy; 2026 DomusGPT // VIB3 Core Integration Active</p>
    </footer>

  </div>

  <!-- Game Container -->
  <div id="game-container">
      <div id="flutter-loader">LOADING CORE...</div>
      <!-- Flutter renders here implicitly if fullscreen, or we control visibility -->
  </div>

  <script>
    // --- GSAP & Lenis Setup ---
    gsap.registerPlugin(ScrollTrigger);

    const lenis = new Lenis({
      duration: 1.2,
      easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
      smooth: true,
    });

    function raf(time) {
      lenis.raf(time);
      requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);

    // --- Hero Animation ---
    // Split text into chars manually for the effect
    const title = document.getElementById('hero-title');
    const chars = title.innerText.split('');
    title.innerHTML = chars.map(char => `<span class="hero-char">${char}</span>`).join('');

    gsap.from('.hero-char', {
      duration: 1.5,
      y: () => Math.random() * 100 + 50, // 50-150px offset
      opacity: 0,
      stagger: 0.05,
      ease: "power4.out",
      scrollTrigger: {
        trigger: ".hero-section",
        start: "top center",
      }
    });

    gsap.from('.hero-subtitle', {
      duration: 1,
      y: 20,
      opacity: 0,
      delay: 1,
      ease: "power2.out"
    });

    // --- Cards Animation (Pinned 3D Scroll) ---
    const cardsTl = gsap.timeline({
      scrollTrigger: {
        trigger: ".cards-section",
        start: "top top",
        end: "+=2000", // Pin distance
        scrub: 1,
        pin: true,
      }
    });

    // 0.1 (progress) → 0.3 (hero) → 0.5 (cards/energy) → 0.8 (trinity)
    // Simplified 3-step sequence

    // Step 1: Card 1 comes forward
    cardsTl.to('.card-1', { z: 50, rotateY: 5, duration: 1 })
           .to('.card-1', { z: 0, rotateY: 0, duration: 0.5 }); // Settle

    // Step 2: Card 2 enters
    cardsTl.fromTo('.card-2',
      { z: -500, opacity: 0, x: 200 },
      { z: 20, opacity: 1, x: 50, rotateY: -5, duration: 1 }, "<+=0.5"
    );

    // Step 3: Card 3 enters
    cardsTl.fromTo('.card-3',
      { z: -500, opacity: 0, x: -200 },
      { z: 20, opacity: 1, x: -50, rotateY: 5, duration: 1 }, "<+=0.5"
    );

    // Final: All rotate slightly
    cardsTl.to('.feature-card', { rotateY: (i) => (i-1) * 10, duration: 1 });


    // --- Launch System Logic ---
    const launchBtn = document.getElementById('launch-btn');
    const landing = document.getElementById('landing');
    const gameContainer = document.getElementById('game-container');
    const flutterLoader = document.getElementById('flutter-loader');

    let isGameLoaded = false;
    let isLaunchClicked = false;

    // Hook into Flutter loaded
    window.addEventListener('flutter-first-frame', function() {
        console.log('Flutter First Frame Rendered');
        isGameLoaded = true;

        // If launch was already clicked, now hide the loader container
        if (isLaunchClicked) {
             gsap.to(gameContainer, { opacity: 0, duration: 0.5, onComplete: () => {
                 gameContainer.style.display = 'none';
             }});
        }
    });

    launchBtn.addEventListener('click', () => {
        isLaunchClicked = true;

        // Animation Out of Landing Page
        gsap.to(landing, {
            opacity: 0,
            y: -50,
            duration: 1,
            ease: "power2.inOut",
            onComplete: () => {
                landing.style.display = 'none';

                if (isGameLoaded) {
                     // Game is ready, just show it (by ensuring no overlays)
                     // Game Container might be visible (opacity 0 -> active logic needed?)
                     // Actually, if game is ready, we don't need game-container overlay at all.
                } else {
                     // Game not ready, show loader overlay
                     gameContainer.classList.add('active');
                     flutterLoader.style.display = 'block';
                }
            }
        });
    });

  </script>

  <!-- Flutter Bootstrap -->
  <script src="flutter_bootstrap.js" async></script>

</body>
</html>
